<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Fullscreen Dynamic Lockscreen</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Roboto+Mono:wght@500&family=Roboto:wght@400;500&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; overflow: hidden; font-family: 'Roboto', sans-serif; }
        body { background-color: #1a1a1a; color: white; text-align: center; }

        /* CHANGE #1 IS HERE */
        #lock-screen { position: relative; width: 100vw; height: 100vh; background-image: url('https://images.pexels.com/photos/807598/pexels-photo-807598.jpeg'); background-size: cover; background-position: center center; overflow: hidden; transition: background-image 0.5s ease-in-out; text-align: left; }
        
        #lock-screen.panning-active { cursor: grab; } #lock-screen.panning-active:active { cursor: grabbing; }
        #status-bar { position: absolute; top: 20px; right: 30px; font-size: 1rem; text-shadow: 1px 1px 3px rgba(0,0,0,0.6); z-index: 20; }
        #weather-info { display: flex; align-items: center; gap: 10px; cursor: pointer; user-select: none; padding: 10px 15px; border-radius: 12px; transition: background-color 0.2s; background-color: rgba(0, 0, 0, 0.2); }
        #weather-info:hover { background-color: rgba(255,255,255,0.1); }
        .draggable-item { position: absolute; user-select: none; cursor: grab; z-index: 10; } .draggable-item:active { cursor: grabbing; z-index: 11; }
        #clock { top: 30%; left: 50%; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; justify-content: center; font-family: 'Oswald', sans-serif; font-weight: 700; color: #fff; filter: drop-shadow(0 0 20px rgba(0,0,0,0.5)); }
        #hours, #minutes { font-size: clamp(6rem, 15vw, 12rem); line-height: 0.8; pointer-events: none; } #minutes { margin-top: -1.5rem; }
        .app-icon { width: 70px; height: 70px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4)); transition: transform 0.2s ease; } .app-icon:active { transform: scale(1.1); }
        .app-icon svg { width: 100%; height: 100%; }
        #youtube-music-btn { top: 60%; left: calc(50% - 100px); } #youtube-btn { top: 60%; left: calc(50% + 30px); }
        #stock-widget { position: absolute; top: 75%; left: 50%; transform: translateX(-50%); background-color: rgba(0, 0, 0, 0.2); padding: 10px 15px; border-radius: 12px; color: white; font-family: 'Roboto', sans-serif; font-size: 1rem; text-shadow: 1px 1px 3px rgba(0,0,0,0.6); display: flex; flex-direction: column; gap: 8px; min-width: 190px; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); }
        .stock-row { display: flex; justify-content: space-between; align-items: center; }
        .stock-info { display: flex; align-items: center; gap: 10px; font-weight: 500; letter-spacing: 0.5px;}
        .stock-price { font-family: 'Roboto Mono', monospace; font-weight: 500; font-size: 1.1rem; }
        .stock-info .fa-caret-up { color: #4CAF50; }
        .stock-info .fa-caret-down { color: #F44336; }
        #wallpaper-menu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); display: none; justify-content: center; align-items: center; z-index: 1000; opacity: 0; transition: opacity 0.3s ease; } #wallpaper-menu.visible { display: flex; opacity: 1; }
        .menu-content { background-color: #2c2c2e; padding: 30px; border-radius: 20px; width: 90%; max-width: 500px; color: #f2f2f7; text-align: center; position: relative; box-shadow: 0 5px 25px rgba(0,0,0,0.5); transform: scale(0.95); transition: transform 0.3s ease; } #wallpaper-menu.visible .menu-content { transform: scale(1); }
        #close-menu-btn { position: absolute; top: 10px; right: 15px; background: none; border: none; color: #aaa; font-size: 2rem; cursor: pointer; line-height: 1; }
        #wallpaper-url-input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 10px; border: 1px solid #555; background-color: #3a3a3c; color: white; font-size: 1rem; outline: none; }
        #wallpaper-choices { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; max-height: 200px; overflow-y: auto; padding: 10px; background-color: #1c1c1e; border-radius: 10px; }
        .wallpaper-thumbnail { position: relative; width: 100%; padding-bottom: 100%; background-size: cover; background-position: center; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: border-color 0.2s, transform 0.2s; }
        .wallpaper-thumbnail:hover { border-color: #0a84ff; transform: scale(1.05); }
        .remove-thumb-btn { position: absolute; top: 2px; right: 2px; width: 20px; height: 20px; background-color: rgba(0,0,0,0.6); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 14px; line-height: 20px; font-family: sans-serif; cursor: pointer; opacity: 0; transition: opacity 0.2s; }
        .wallpaper-thumbnail:hover .remove-thumb-btn { opacity: 1; }
        #qr-upload-btn { background-color: #0a84ff; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 0.9em; margin-top: 15px; }
        #qr-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); display: none; justify-content: center; align-items: center; z-index: 1001; }
        #qr-modal-content { background: #fff; padding: 25px; border-radius: 16px; text-align: center; color: #333; }
        #qr-code { padding: 10px; background: white; margin-bottom: 15px; display: inline-block; } #qr-code img { display: block; margin: auto; }
        #upload-view { display: none; justify-content: center; align-items: center; width: 100%; height: 100%; padding: 20px; }
        #upload-status { margin-top: 20px; font-size: 1.1rem; min-height: 1.2em; }
        #phone-url-container { display: flex; flex-direction: column; width: 90%; max-width: 400px; gap: 15px; text-align: center; }
        #phone-url-container h2 { color: #f2f2f7; }
        #phone-url-container p { color: #aeb0b5; font-size: 0.9rem; margin-bottom: 5px; }
        #phone-url-input { width: 100%; padding: 15px; border-radius: 10px; border: 1px solid #555; background-color: #3a3a3c; color: white; font-size: 1rem; outline: none; }
        #phone-url-submit { background-color: #0a84ff; color: white; border: none; padding: 15px 20px; border-radius: 10px; cursor: pointer; font-size: 1.1rem; font-weight: 500; }
        #phone-url-submit:disabled { background-color: #555; cursor: not-allowed; }
    </style>
</head>
<body>
    <div id="lock-screen">
        <div id="status-bar"><div id="weather-info" title="Double-click to change wallpaper"><span id="date"></span> <i id="weather-icon" class="fa-solid fa-cloud-sun"></i> <span id="temperature">...</span></div></div>
        <div id="clock" class="draggable-item" title="Drag to move, double-click for fullscreen"><div id="hours">00</div><div id="minutes">00</div></div>
        <div id="youtube-music-btn" class="draggable-item app-icon"><a href="https://music.youtube.com/" target="_blank" rel="noopener noreferrer"><svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50" fill="#FF0000"/><circle cx="50" cy="50" r="23" fill="none" stroke="white" stroke-width="4"/><polygon points="43,38 62,50 43,62" fill="white"/></svg></a></div>
        <div id="youtube-btn" class="draggable-item app-icon"><a href="https://www.youtube.com/" target="_blank" rel="noopener noreferrer"><svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50" fill="#FF0000"/><path d="M 35,29 A 10,10 0 0 0 25,39 V 61 A 10,10 0 0 0 35,71 H 65 A 10,10 0 0 0 75,61 V 39 A 10,10 0 0 0 65,29 Z" fill="white"/><polygon points="45,42 62,50 45,58" fill="#FF0000"/></svg></a></div>
        <div id="stock-widget" class="draggable-item">
            <div class="stock-row" data-symbol="TSLA"><div class="stock-info"><i class="fa-solid"></i> TSLA</div><span class="stock-price">...</span></div>
            <div class="stock-row" data-symbol="GOOGL"><div class="stock-info"><i class="fa-solid"></i> GOOGL</div><span class="stock-price">...</span></div>
            <div class="stock-row" data-symbol="AKBA"><div class="stock-info"><i class="fa-solid"></i> AKBA</div><span class="stock-price">...</span></div>
        </div>
    </div>
    <div id="wallpaper-menu"><div class="menu-content"><button id="close-menu-btn">Ã—</button><h2>Change Wallpaper</h2><p>Paste an image URL below or add from phone.</p><input type="text" id="wallpaper-url-input" placeholder="https://example.com/image.jpg"><button id="qr-upload-btn">Add from Phone</button><h3>Your Wallpapers</h3><div id="wallpaper-choices"></div></div></div>
    <div id="qr-modal"><div id="qr-modal-content"><h2>Scan with your phone</h2><div id="qr-code"></div><p>Scan to send an image URL from your phone.</p></div></div>
    <div id="upload-view"><div id="phone-url-container"><h2>Enter Image URL</h2><p>Find an image on your phone, copy its URL, and paste it below.</p><input type="url" id="phone-url-input" placeholder="https://example.com/image.jpg"><button id="phone-url-submit">Set as Wallpaper</button><h2 id="upload-status"></h2></div></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const NPOINT_BIN_ID = 'f76d79c771a62c1ce33a';
            const lockScreen = document.getElementById('lock-screen');
            const clock = document.getElementById('clock');
            const wallpaperMenu = document.getElementById('wallpaper-menu');
            const qrModal = document.getElementById('qr-modal');
            
            // CHANGE #2 IS HERE
            const initialWallpaper = { url: 'https://images.pexels.com/photos/807598/pexels-photo-807598.jpeg', position: 'center center' };

            let isPanningMode = false, currentWallpaperImg = new Image(), pollingInterval;

            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('upload') && urlParams.has('session')) {
                document.body.style.backgroundColor = '#1a1a1a';
                document.getElementById('lock-screen').style.display = 'none';
                document.getElementById('wallpaper-menu').style.display = 'none';
                document.getElementById('qr-modal').style.display = 'none';
                document.getElementById('upload-view').style.display = 'flex';
                handlePhoneUpload(urlParams.get('session'));
            } else {
                initializeLockscreen();
            }

            function handlePhoneUpload(session) {
                const urlInput = document.getElementById('phone-url-input');
                const submitBtn = document.getElementById('phone-url-submit');
                const statusElem = document.getElementById('upload-status');
                submitBtn.addEventListener('click', () => {
                    const imageUrl = urlInput.value.trim();
                    if (!imageUrl || !imageUrl.startsWith('http')) { statusElem.textContent = 'Please enter a valid image URL.'; return; }
                    statusElem.textContent = 'Sending to PC...';
                    submitBtn.disabled = true;
                    fetch(`https://api.npoint.io/${NPOINT_BIN_ID}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ [session]: imageUrl }) })
                    .then(r => { if (r.ok) { statusElem.textContent = 'Success!'; urlInput.disabled = true; } else { throw new Error('Failed to update PC.'); } })
                    .catch(e => { statusElem.textContent = `Error: ${e.message}`; submitBtn.disabled = false; });
                });
            }

            function initializeLockscreen() {
                const FINNHUB_API_KEY = 'd1obuihr01qtrav0d5sgd1obuihr01qtrav0d5t0';
                const STOCK_SYMBOLS = ['TSLA', 'GOOGL', 'AKBA'];

                function updateStockWidget() {
                    if (!FINNHUB_API_KEY || FINNHUB_API_KEY.includes('PASTE')) {
                        console.error("Finnhub API key is not set.");
                        document.querySelectorAll('.stock-price').forEach(el => el.textContent = 'No Key');
                        return;
                    }
                    STOCK_SYMBOLS.forEach(symbol => {
                        fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${FINNHUB_API_KEY}`)
                            .then(response => response.json())
                            .then(data => {
                                const row = document.querySelector(`.stock-row[data-symbol="${symbol}"]`);
                                if (!row || !data || typeof data.c === 'undefined') return;
                                const priceEl = row.querySelector('.stock-price');
                                const iconEl = row.querySelector('i');
                                priceEl.textContent = (symbol === 'AKBA') ? data.c.toFixed(3) : data.c.toFixed(2);
                                iconEl.className = 'fa-solid';
                                if (data.d > 0) iconEl.classList.add('fa-caret-up');
                                else if (data.d < 0) iconEl.classList.add('fa-caret-down');
                            }).catch(error => console.error(`Error fetching ${symbol}:`, error));
                    });
                }

                (function setupBaseFeatures() {
                    const DRAGGABLE_ELEMENT_IDS = ['clock', 'youtube-music-btn', 'youtube-btn', 'stock-widget'];
                    const timeElems = { h: document.getElementById('hours'), m: document.getElementById('minutes'), d: document.getElementById('date') };
                    const weatherElems = { t: document.getElementById('temperature'), i: document.getElementById('weather-icon') };
                    let clockScale = 1;
                    const updateTime = () => { const n = new Date(); timeElems.h.textContent = String(n.getHours()).padStart(2, '0'); timeElems.m.textContent = String(n.getMinutes()).padStart(2, '0'); timeElems.d.textContent = n.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }); };
                    const applyClockScale = (scale) => { const baseSizeVW = 15; const newSize = baseSizeVW * scale; timeElems.h.style.fontSize = `clamp(${newSize * 0.4}rem, ${newSize}vw, ${newSize * 0.8}rem)`; timeElems.m.style.fontSize = `clamp(${newSize * 0.4}rem, ${newSize}vw, ${newSize * 0.8}rem)`; clockScale = scale; };
                    const savePos = () => { const p = {}; DRAGGABLE_ELEMENT_IDS.forEach(id => { const e = document.getElementById(id); if (e) { p[id] = { t: e.style.top, l: e.style.left }; if (id === 'clock') { p[id].s = clockScale; } } }); localStorage.setItem('lockscreenItemPositions', JSON.stringify(p)); };
                    const loadPos = () => { const p = JSON.parse(localStorage.getItem('lockscreenItemPositions')); if (p) { Object.keys(p).forEach(id => { const e = document.getElementById(id); const pos = p[id]; if (e && pos.t && pos.l) { e.style.top = pos.t; e.style.left = pos.l; e.style.transform = 'none'; if (id === 'clock' && pos.s) { applyClockScale(pos.s); } } }); } };
                    const makeDraggable = (el) => { let oX, oY, isD, hasM; let isPinching = false, initialPinchDist = 0, initialScale = 1; const getDist = (t) => Math.hypot(t[0].clientX - t[1].clientX, t[0].clientY - t[1].clientY); const mv = (e) => { if (isPinching && e.touches && e.touches.length === 2) { e.preventDefault(); const newDist = getDist(e.touches); const scaleRatio = newDist / initialPinchDist; applyClockScale(Math.max(0.5, Math.min(initialScale * scaleRatio, 3))); return; } if (!isD) return; e.preventDefault(); hasM = true; const cX = e.touches ? e.touches[0].clientX : e.clientX, cY = e.touches ? e.touches[0].clientY : e.clientY; let nX = cX - oX, nY = cY - oY; const sR = lockScreen.getBoundingClientRect(), eR = el.getBoundingClientRect(); nX = Math.max(0, Math.min(nX, sR.width - eR.width)); nY = Math.max(0, Math.min(nY, sR.height - eR.height)); el.style.left = `${nX}px`; el.style.top = `${nY}px`; el.style.transform = 'none'; }; const sD = (e) => { if (e.touches && e.touches.length === 2 && el.id === 'clock') { isPinching = true; isD = false; initialPinchDist = getDist(e.touches); initialScale = clockScale; return; } isD = true; hasM = false; const cX = e.touches ? e.touches[0].clientX : e.clientX, cY = e.touches ? e.touches[0].clientY : e.clientY; oX = cX - el.offsetLeft; oY = cY - el.offsetTop; document.addEventListener('mousemove', mv); document.addEventListener('touchmove', mv, { passive: false }); document.addEventListener('mouseup', stD); document.addEventListener('touchend', stD); }; const stD = () => { if (!isD && !isPinching) return; isD = false; isPinching = false; savePos(); document.removeEventListener('mousemove', mv); document.removeEventListener('touchmove', mv); document.removeEventListener('mouseup', stD); document.removeEventListener('touchend', stD); }; el.addEventListener('mousedown', sD); el.addEventListener('touchstart', sD, { passive: false }); const lnk = el.querySelector('a'); if (lnk) lnk.addEventListener('click', (e) => { if (hasM) e.preventDefault(); }); };
                    
                    setInterval(updateTime, 1000); updateTime();
                    DRAGGABLE_ELEMENT_IDS.forEach(id => { const el = document.getElementById(id); if (el) makeDraggable(el); });
                    clock.addEventListener('dblclick', () => { if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); });
                    const fetchWeather = () => { const iM = { 'sunny': 'fa-sun', 'clear': 'fa-sun', 'partly cloudy': 'fa-cloud-sun', 'cloudy': 'fa-cloud', 'overcast': 'fa-cloud', 'mist': 'fa-smog', 'fog': 'fa-smog', 'patchy rain': 'fa-cloud-rain', 'rain': 'fa-cloud-showers-heavy', 'drizzle': 'fa-cloud-rain', 'patchy snow': 'fa-snowflake', 'snow': 'fa-snowflake', 'sleet': 'fa-cloud-meatball', 'ice pellets': 'fa-icicles', 'thunder': 'fa-cloud-bolt', 'blizzard': 'fa-wind' }; fetch('https://wttr.in/Trondheim?format=j1').then(r => r.json()).then(d => { const c = d.current_condition[0]; weatherElems.t.textContent = `${c.temp_C}Â°C`; const ds = c.weatherDesc[0].value.toLowerCase(); let ic = 'fa-cloud-sun'; for (const k in iM) { if (ds.includes(k)) { ic = iM[k]; break; } } weatherElems.i.className = `fa-solid ${ic}`; }).catch(e => { weatherElems.t.textContent = 'N/A'; }); };
                    
                    loadPos();
                    fetchWeather(); setInterval(fetchWeather, 30 * 60 * 1000);
                    updateStockWidget(); setInterval(updateStockWidget, 60000);
                })();
                
                const getWps = () => JSON.parse(localStorage.getItem('lockscreenWallpapers_v2')) || [initialWallpaper];
                const saveWps = (wps) => localStorage.setItem('lockscreenWallpapers_v2', JSON.stringify(wps));
                const setWp = (wpObj) => { exitPanningMode(); lockScreen.style.backgroundImage = `url('${wpObj.url}')`; lockScreen.style.backgroundPosition = wpObj.position || 'center center'; currentWallpaperImg.src = wpObj.url; };
                const renderWpChoices = () => { const cont = document.getElementById('wallpaper-choices'); cont.innerHTML = ''; getWps().forEach(wp => { const thumb = document.createElement('div'); thumb.className = 'wallpaper-thumbnail'; thumb.style.backgroundImage = `url('${wp.url}')`; const rmvBtn = document.createElement('span'); rmvBtn.className = 'remove-thumb-btn'; rmvBtn.innerHTML = 'Ã—'; rmvBtn.title = 'Remove wallpaper'; rmvBtn.addEventListener('click', (e) => { e.stopPropagation(); const newWps = getWps().filter(w => w.url !== wp.url); saveWps(newWps); renderWpChoices(); }); thumb.appendChild(rmvBtn); thumb.addEventListener('click', () => { setWp(wp); wallpaperMenu.classList.remove('visible'); }); cont.appendChild(thumb); }); };
                document.getElementById('wallpaper-url-input').addEventListener('keydown', (e) => { if (e.key === 'Enter') { const url = e.target.value.trim(); if (url.match(/\.(jpeg|jpg|gif|png|webp)$/i)) { const wps = getWps(); if (!wps.some(w => w.url === url)) { const newWp = { url: url, position: 'center center' }; wps.push(newWp); saveWps(wps); setWp(newWp); renderWpChoices(); } e.target.value = ''; } else { alert('Invalid URL.'); } } });
                function exitPanningMode() { if (!isPanningMode) return; isPanningMode = false; lockScreen.classList.remove('panning-active'); const url = currentWallpaperImg.src; const wps = getWps(); const idx = wps.findIndex(w => w.url === url); if (idx > -1) { wps[idx].position = lockScreen.style.backgroundPosition; saveWps(wps); } }
                lockScreen.addEventListener('dblclick', (e) => { if (e.target !== lockScreen) return; if (isPanningMode) { exitPanningMode(); } else { const sW = lockScreen.clientWidth, sH = lockScreen.clientHeight, iW = currentWallpaperImg.naturalWidth, iH = currentWallpaperImg.naturalHeight; if (iW > sW || iH > sH) { isPanningMode = true; lockScreen.classList.add('panning-active'); } } });
                let isDraggingWp = false, sPanX, sPanY, sBgX, sBgY;
                lockScreen.addEventListener('mousedown', (e) => { if (!isPanningMode || e.target !== lockScreen) return; isDraggingWp = true; const bgPos = window.getComputedStyle(lockScreen).backgroundPosition.split(' '); sBgX = parseFloat(bgPos[0]); sBgY = parseFloat(bgPos[1]); sPanX = e.clientX; sPanY = e.clientY; });
                document.addEventListener('mousemove', (e) => { if (!isDraggingWp) return; const dX = e.clientX - sPanX, dY = e.clientY - sPanY; let nBgX = sBgX + dX, nBgY = sBgY + dY; const sW = lockScreen.clientWidth, sH = lockScreen.clientHeight, iW = currentWallpaperImg.naturalWidth, iH = currentWallpaperImg.naturalHeight; const sR = sW / sH, iR = iW / iH; let scW, scH; if (iR > sR) { scH = sH; scW = sH * iR; } else { scW = sW; scH = sW / iR; } const minX = sW - scW, minY = sH - scH; nBgX = Math.max(minX, Math.min(0, nBgX)); nBgY = Math.max(minY, Math.min(0, nBgY)); lockScreen.style.backgroundPosition = `${nBgX}px ${nBgY}px`; });
                document.addEventListener('mouseup', () => { isDraggingWp = false; });
                document.getElementById('qr-upload-btn').addEventListener('click', () => { if (pollingInterval) clearInterval(pollingInterval); const session = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`; const uploadUrl = `${window.location.href.split('?')[0]}?upload=true&session=${session}`; const qrCodeContainer = document.getElementById('qr-code'); qrCodeContainer.innerHTML = ''; qrModal.style.display = 'flex'; new QRCode(qrCodeContainer, { text: uploadUrl, width: 200, height: 200 }); startPolling(session); });
                qrModal.addEventListener('click', (e) => { if (e.target === qrModal) { qrModal.style.display = 'none'; clearInterval(pollingInterval); } });
                function startPolling(session) { pollingInterval = setInterval(() => { fetch(`https://api.npoint.io/${NPOINT_BIN_ID}`, { cache: 'no-cache' }).then(r => r.json()).then(data => { if (data && data[session]) { clearInterval(pollingInterval); qrModal.style.display = 'none'; const newWp = { url: data[session], position: 'center center' }; const wps = getWps(); if (!wps.some(w => w.url === newWp.url)) { wps.push(newWp); saveWps(wps); } setWp(newWp); renderWpChoices(); } }).catch(err => { console.log("Polling... waiting for data."); }); }, 2500); }
                document.getElementById('weather-info').addEventListener('dblclick', () => wallpaperMenu.classList.add('visible'));
                document.getElementById('close-menu-btn').addEventListener('click', () => wallpaperMenu.classList.remove('visible'));
                wallpaperMenu.addEventListener('click', (e) => { if (e.target === wallpaperMenu) wallpaperMenu.classList.remove('visible'); });
                renderWpChoices();
                const lastWp = getWps().slice(-1)[0] || initialWallpaper; setWp(lastWp);
            }
        });
    </script>
</body>
</html>
